package cn.itcast.test;

import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.classic.Session;
import org.junit.Test;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import cn.itcast.test.entity.Person;
import cn.itcast.test.service.TestService;

public class TestMerge {

	ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(
			"applicationContext.xml");

	@Test
	public void testSpring() {

		TestService testService = (TestService) context.getBean("testService");
		testService.say();
	}

	@Test
	public void testHibernate() {
		SessionFactory sf = (SessionFactory) context.getBean("sessionFactory");
		Session session = sf.openSession();
		Transaction transaction = session.beginTransaction();
		session.save(new Person("???2"));
		transaction.commit();
		session.close();
	}

	@Test
	public void testServiceAndDAo() {
		TestService ts = (TestService) context.getBean("testService");
		ts.save(new Person("???2"));
	}

	@Test
	public void testReadOnlyTransaction() {//???????????
		TestService ts = (TestService) context.getBean("testService");
		//??????TestServiceImpl??findPerson??????????????person,????????????
		//?????????????????????????????person???
		Person p = ts.findPersonById("1");
		System.out.println("??????????" + p.getName());
	}

	@Test
	public void testRollbackTransaction() {//??????????
		//??????TestServiceImpl??save?????????????person????????0?????
		//?????????????????????person????????????person?????
		TestService ts = (TestService) context.getBean("testService");
		ts.save(new Person("???3"));
	}
}
